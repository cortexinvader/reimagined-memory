<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin</title>
  <style>body{font-family:system-ui,Segoe UI,Roboto,Arial;padding:24px}table{border-collapse:collapse}td,th{padding:8px;border:1px solid #ddd}</style>
</head>
<body>
  <h2>Admin panel</h2>
  <div><a href="{{ url_for('dashboard') }}">Back</a></div>

  <h3>Users</h3>
  <table>
    <tr><th>id</th><th>username</th><th>is_admin</th></tr>
    {% for u in users %}
      <tr><td>{{ u.id }}</td><td>{{ u.username }}</td><td>{{ u.is_admin }}</td></tr>
    {% endfor %}
  </table>

  <h3>Collections</h3>
  <ul>
    {% for c in collections %}
      <li>{{ c }}</li>
    {% endfor %}
  </ul>

  <h3>Create user</h3>
  <form id="createUser">
    <input id="un" placeholder="username">
    <input id="pw" placeholder="password" type="password">
    <label><input id="adm" type="checkbox"> is admin</label>
    <button>Create</button>
  </form>

  <div id="created"></div>

  <script>
  document.getElementById("createUser").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const u=document.getElementById("un").value.trim();
    const p=document.getElementById("pw").value.trim();
    const is_admin=document.getElementById("adm").checked;
    if(!u||!p) return alert("missing");
    const res=await fetch("/api/admin/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:u,password:p,is_admin:is_admin})});
    const j=await res.json();
    if(res.ok){
      document.getElementById("created").innerText = "Created. API key: " + j.api_key;
    } else {
      alert(j.error || "error");
    }
  });
  </script>
</body>
</html>
